{% extends "base.html" %}
{% load static %}
{% block title  %}smartpayapp | Homepage{% endblock  %}
{% block content %}

    <!--HEADER SECTION-->
    <section class="welcome-header">
        <div class="welcome-content">
            <div class="welcome-text">
                <h2>Welcome, {{ user.first_name }} {{ user.last_name }}!</h2>
                <p>Hereâ€™s your salary advance and loan overview at a glance.</p>
                <br>
                <p>Your Staff ID: <strong>{{ user.username }}</strong></p>
            </div>
            <div class="profile-pic">
                <img src="{{ profile.profile_picture.url }}" alt="Profile Picture">
                <br>
                <a href="{% url 'update_profile' %}" class="btn-edit">Change Picture</a>
            </div>
        </div>
    </section>

    <!--QUICK GLANCE SECTION-->   
    <section class="quick-actions">
        <div class="container">
            
            <!--Request Salary Card-->
            <a href="{% url 'request_form' %}" class="action-card">
            <div class="action-icon">
                <img src="{% static 'img/icons/l1.png' %}" alt="Salary Advance">
            </div>
            <h3>Request Salary Advance</h3>
            <p>Submit your salary advance request securely.</p>
            </a>
             
            <!--Internal Loan Card-->
            <a href="{% url 'internal_loan' %}" class="action-card">
            <div class="action-icon">
                <img src="{% static 'img/icons/l2.png' %}" alt="Internal Loan">
            </div>
            <h3>Request Internal Loan</h3>
            <p>Apply for organizational loans easily.</p>
            </a>

            <!--Message Finance Card-->
            <a href="{% url 'message_finance' %}" class="action-card">
            <div class="action-icon">
                <img src="{% static 'img/icons/l3.png' %}" alt="Message Finance">
            </div>
            <h3>Message Finance Office</h3>
            <p>Send private messages directly to finance.</p>
            </a>

            <!--Support Query Card-->
            <a href="{% url 'support_query' %}" class="action-card">
            <div class="action-icon">
                <img src="{% static 'img/icons/l1.png' %}" alt="Support Query">
            </div>
            <h3>Submit Support Query</h3>
            <p>Report issues or ask questions securely.</p>
            </a>

        </div>
    </section>
    
    <!--FINACIAL OVERVIEW-->
    <section class="financial-overview">
        <div class="overview-container">  
            <!--Current Salary Card-->
            <div class="overview-card">
                <div class="icon">
                    <img src="{% static 'img/icons/l2.png' %}" alt="Salary Icon">
                </div>
                <h2>{{ current_salary }}</h2>
                <p>Current Salary</p>
            </div>

            <!-- Overview Card -->
            <div class="overview-card">
                <div class="icon">
                    <img src="{% static 'img/icons/l2.png' %}" alt="Outstanding Loans Icon">
                </div>
                <!-- Display dynamic outstanding loan balance -->
                <h2>KSh {{ active_loans|floatformat:2 }}</h2>
                <p>Outstanding Loans</p>
            </div>

            <!--Advance salary Eligibility Card-->
            <div class="overview-card">
                <div class="icon">
                    <img src="{% static 'img/icons/l2.png' %}" alt="Eligibility Icon">
                </div>
                <h2>{{ advance_eligibility }}</h2>
                <p>Advance Eligibility</p>
            </div>
        </div>
    </section>
    <br><br><br>

    <!-- ================================================================
        Salary Advance History
    ================================================================ -->
    <section class="loan-history">
        <h2>Salary Advance History</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                    <th>Date Requested</th>
                    <th>Amount (KSh)</th>
                    <th>Remaining Salary (KSh)</th>
                    <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% if salary_advances %}
                    {% for advance in salary_advances %}
                    <tr>
                        <td data-label="Date Requested">{{ advance.date_requested|date:"Y-m-d" }}</td>
                        <td data-label="Amount (KSh)">KSh {{ advance.amount|floatformat:2 }}</td>
                        <td data-label="Remaining Salary (KSh)">
                        {% if advance.remaining_salary %}
                            KSh {{ advance.remaining_salary|floatformat:2 }}
                        {% else %}
                            N/A
                        {% endif %}
                        </td>
                        <td data-label="Status">
                        <span class="status {{ advance.status|lower }}">{{ advance.status }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="4" style="text-align:center;">No salary advances found</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </section>

    <!-- ================================================================
        Internal Loan History
    ================================================================ -->
    <section class="loan-history">
        <h2>Loan History</h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                    <th>Date Requested</th>
                    <th>Amount (KSh)</th>
                    <th>Status</th>
                    <th>Repayment Progress</th>
                    </tr>
                </thead>
                <tbody>
                    {% if internal_loans %}
                    {% for loan in internal_loans %}
                        <tr>
                        <td data-label="Date Requested">{{ loan.created_at|date:"Y-m-d" }}</td>
                        <td data-label="Amount (KSh)">KSh {{ loan.amount|floatformat:2 }}</td>
                        <td data-label="Status">
                            <span class="status {{ loan.status|lower }}">{{ loan.status }}</span>
                        </td>
                        <td data-label="Repayment Progress">
                            {% if loan.status == "Approved" %}
                            <div class="progress-bar">
                                <div class="progress" style="width: {{ loan.repayment_progress }}%;"></div>
                            </div>
                            <small>{{ loan.repayment_progress }}%</small>
                            {% else %}
                            <span style="color: #888;">N/A</span>
                            {% endif %}
                        </td>
                        </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="4" style="text-align:center;">No loans found</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </section>

    
  
    <br><br><br>
    <section class="messaging-support">
        <div class="section-header">
            <h2>Messaging & Support</h2>
        </div>

        <div class="support-container">

            <!-- Messages Inbox (Chat Style) -->
            <div class="messages-panel">
                <h3>Inbox</h3>
                <div class="chat-container">

                    <div class="chat-message unread">
                        <div class="chat-sender">
                            Finance Office
                            <span class="unread-badge"></span> <!-- Unread indicator -->
                        </div>
                        <div class="chat-content">Your recent advance request has been approved.</div>
                        <div class="chat-time">10:15 AM | 2025-08-10</div>
                    </div>                    

                    <div class="chat-message unread">
                        <div class="chat-sender">Finance Office</div>
                        <div class="chat-content">Your recent advance request has been approved.</div>
                        <div class="chat-time">10:15 AM | 2025-08-10</div>
                    </div>
                    <div class="chat-message read">
                        <div class="chat-sender">Finance Office</div>
                        <div class="chat-content">Reminder: Pending loan repayment due this month.</div>
                        <div class="chat-time">09:30 AM | 2025-08-05</div>
                    </div>
                    <!-- Add more chat messages -->
                </div>
            </div>

            <!-- Support Queries Panel -->
            <div class="support-panel">
                <h3>Support Queries</h3>
                <div class="query">
                    <span class="query-text">How do I update my Staff ID?</span>
                    <span class="query-status pending">Pending</span>
                </div>
                <div class="query">
                    <span class="query-text">Request for repayment schedule clarification.</span>
                    <span class="query-status resolved">Resolved</span>
                </div>
                <button class="new-query-btn">New Query</button>
            </div>

        </div>
    </section>

{% endblock  %}